<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Notification Test</title>
    </head>
    <body>
        <h1>User Notifications</h1>
        <ul id="notifications-list"></ul>

        <script>
            // Replace with the actual user_id and token
            let currentNotifications = [];
            const userId = "4"; // Example user ID
            const urlSocket = `ws://127.0.0.1:8000/ws/notifications/${userId}/`;
            const socket = new WebSocket(urlSocket);
            socket.onopen = function () {
                console.log("WebSocket connected");
            };

            socket.onmessage = function (event) {
                const data = JSON.parse(event.data);

                // Determine if the data is a single notification or a list
                const notifications = Array.isArray(data) ? data : [data];

                // Update the current notifications list
                currentNotifications = currentNotifications.concat(notifications);

                // Render all notifications
                renderNotifications();
            };
            function renderNotifications() {
                const notificationsList = document.getElementById("notifications-list");
                notificationsList.innerHTML = ""; // Clear the list before updating

                // Display all notifications
                currentNotifications.forEach((notification) => {
                    const li = document.createElement("li");
                    li.textContent = `${notification.message} (${notification.notification_type})`;
                    notificationsList.appendChild(li);
                });
            }
            socket.onclose = function () {
                console.log("WebSocket connection closed");
            };

            socket.onerror = function (error) {
                console.error("WebSocket error:", error);
            };
        </script>
    </body>
</html>
